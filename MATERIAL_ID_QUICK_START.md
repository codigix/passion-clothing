# Material ID Auto-Generation - Quick Start Guide

## What Changed?

âœ… **Material IDs are now auto-generated and mandatory**
- Format: **M-001, M-002, M-003**, etc.
- Displayed in the Materials tab (read-only field)
- Automatically saved to database

---

## For End Users

### Creating Production Orders with Materials

#### Scenario 1: Loading from Material Request (MRN)
1. Create new production order
2. Select a project in **Step 1: Select Project**
3. Go to **Step 4: Materials**
4. âœ… **Materials auto-load with IDs** (M-001, M-002, etc.)
5. Adjust Quantity and Status as needed
6. Submit order

**Example:**
```
ðŸ“¦ Materials loaded from MRN
âœ“ Material IDs are auto-generated (M-001, M-002, etc.)
âœ“ Read-only fields locked from MRN

Material #1: M-001
  Description: Cotton Fabric
  Qty: 5 Meter
  
Material #2: M-002
  Description: Embroidery Thread
  Qty: 2 Spool
```

#### Scenario 2: Adding Materials Manually
1. In **Step 4: Materials**, click **"Add Material"**
2. âœ… **New material appears with ID: M-001** (auto-generated)
3. Fill in Description, Quantity, Unit, Status
4. Click **"Add Additional Material"** for more
5. âœ… **New material gets M-002**, etc.
6. Submit order

---

## For Developers

### Key Files Modified

#### Backend
- `server/routes/manufacturing.js`
  - Added: `generateMaterialId(index)` - Lines 367-370
  - Updated: Material creation loop - Lines 537-558

#### Frontend
- `client/src/pages/manufacturing/ProductionWizardPage.jsx`
  - Added: `generateNextMaterialId()` - Lines 1806-1812
  - Updated: MRN material mapping - Lines 814-844
  - Updated: Add Material button - Line 1971

### Implementation Details

#### Backend (Auto-Generate on Save)
```javascript
const materialId = material.material_id || generateMaterialId(materialIndex);

await MaterialRequirement.create({
  material_id: materialId,  // âœ… Always has a value
  description: material.description,
  // ...
});
```

#### Frontend (Auto-Generate on Display)
```javascript
const generateNextMaterialId = () => {
  const maxIndex = fields.length > 0 
    ? Math.max(...fields.map((field, idx) => idx)) + 1 
    : 0;
  return `M-${(maxIndex + 1).toString().padStart(3, '0')}`;
};

append({ materialId: generateNextMaterialId(), ... })
```

---

## Testing

### Quick Test
1. Create new production order
2. Select a project with materials
3. Go to Materials step
4. âœ… Check: Material IDs appear as M-001, M-002, etc.
5. Click "Add Material"
6. âœ… Check: New material gets next ID
7. Submit order
8. âœ… Check: Browser console shows `âœ… Material M-001: Description...`

### Console Logs to Look For
```
âœ… Material M-001: Cotton Fabric (5 Meter)
âœ… Material M-002: Thread Polyester (10 Spool)
âœ… Created 2 material requirements with auto-generated IDs
```

---

## FAQ

**Q: Can I change the Material ID?**
- A: No, Material ID is read-only (disabled field in UI). It's auto-generated by the system.

**Q: What if I don't provide a material_id in the request?**
- A: âœ… Backend automatically generates it (M-001, M-002, etc.)

**Q: Are Material IDs unique?**
- A: âœ… Yes, unique per production order (M-001, M-002, etc.). Different orders can have M-001.

**Q: Where are Material IDs stored?**
- A: In the `material_requirements` table, `material_id` column.

**Q: How do I view existing Material IDs?**
- A: When you fetch a production order, Material IDs are displayed in the Materials tab.

**Q: What format should Material ID be?**
- A: Format is automatically generated as M-### (e.g., M-001, M-002, M-999).

---

## Common Workflows

### Workflow 1: Create Order with MRN Materials
```
New Order â†’ Select Project â†’ Materials auto-load with IDs â†’ Submit
```

### Workflow 2: Create Order with Manual Materials
```
New Order â†’ Select Project â†’ Add Material 1 (M-001) â†’ Add Material 2 (M-002) â†’ Submit
```

### Workflow 3: Mixed Materials
```
New Order â†’ Select Project â†’ MRN loads (M-001, M-002) â†’ Add more material (M-003) â†’ Submit
```

---

## Database Schema

### material_requirements Table
```sql
CREATE TABLE material_requirements (
  id INTEGER PRIMARY KEY AUTO_INCREMENT,
  production_order_id INTEGER NOT NULL,
  material_id VARCHAR(100) NOT NULL,  -- âœ… Mandatory, format: M-XXX
  description VARCHAR(500) NOT NULL,
  required_quantity DECIMAL(10,3) NOT NULL,
  unit VARCHAR(20) NOT NULL,
  status ENUM('available', 'shortage', 'ordered', 'allocated', 'consumed'),
  INDEX(material_id),
  FOREIGN KEY(production_order_id) REFERENCES production_orders(id)
);
```

---

## Support

For issues or questions:
1. Check browser console for Material ID generation logs
2. Verify material_id field in database is not null
3. Check that `generateMaterialId()` function is being called

---

## Summary

| Item | Detail |
|------|--------|
| Format | M-001, M-002, M-003, ... M-999 |
| Mandatory | âœ… Yes (not nullable in DB) |
| Auto-Generated | âœ… Yes (both frontend + backend) |
| Read-Only | âœ… Yes (disabled in UI) |
| Fetched by Default | âœ… Yes (loads in Materials tab) |
| Stored | âœ… Yes (in material_requirements table) |